<!doctype html>
<html>

  <style>
    html, body {
    	height: 100%;
		margin: 0px;
    overflow:hidden;
	}

  iframe{
    background-color: black;
  }
	.container {
		height: calc(100% - 140px);
	}
  .minimallink{
    color: #fff;
    text-decoration: none;
  }
  .minimallink:hover{
    color: #fff;
    text-decoration: underline;
  }
</style>


<body style="padding: 0px;">
  <label>
    <div>

      IP:
      <input type="text" id="ip" value="192.168.1">
      From:  
      <input type="text" id="from" value="0">
      To: <input type="text" id="to" value="20">
      String: <input type="text" id="string" value="blog">
      <button id='b' onclick='scan()'>Scan</button>
    </div>
  </label>

  <div id='c' style='background:#000; color: #fff; font-family:monospace; padding: 5px; margin-top:0; height: 100px; overflow-y: auto; '>
  </div>
  
  <div id='demo' style='background:#444; color: #fff; font-family:monospace; padding: 5px; margin-top:0; display: none;'>
  </div>
  
  <iframe id="psxl_iframe" class="container" src="" style="width: calc(50% - 3px); border: none;" title="W3Schools Free Online Web Tutorials">
  </iframe>  

  <iframe id="psxl4k_iframe" class="container" src="" style="width: calc(50% - 3px); border: none;" title="W3Schools Free Online Web Tutorials">
  </iframe>


<script src='./src/utils.js'></script>
<script src='./src/db.js'></script>
<script src='./src/host_scan.js'></script>
<script src='./src/device_scan.js'></script>

<script>

  function hslToHex(h, s, l) {
    l /= 100;
    const a = s * Math.min(l, 1 - l) / 100;
    const f = n => {
      const k = (n + h / 30) % 12;
      const color = l - a * Math.max(Math.min(k - 3, 9 - k, 1), -1);
      return Math.round(255 * color).toString(16).padStart(2, '0');   // convert to Hex and prefix "0" if needed
    };
    var color = `#${f(0)}${f(8)}${f(4)}`;
  }

  function stringToColor(string) {

    // Generte Hash

    var hash = 0;
    if (string.length == 0)
        return hash;
    for (let i = 0; i < string.length; i++) {
        var charCode = string.charCodeAt(i);
        hash = ((hash << 7) - hash) + charCode;
        hash = hash & hash;
    }

    // define the color params

    var hue = Math.abs(hash)%360; // degrees
    var sat = 65; // percentage
    var lum = 50; // percentage

    // convert from HSL to RGB

    lum /= 100;
    const a = sat * Math.min(lum, 1 - lum) / 100;
    const f = n => {
      const k = (n + hue / 30) % 12;
      const col = lum - a * Math.max(Math.min(k - 3, 9 - k, 1), -1);
      return Math.round(255 * col).toString(16).padStart(2, '0');   // convert to Hex and prefix "0" if needed
    };

    var color = `#${f(0)}${f(8)}${f(4)}`;

    return color;
  }


  function log(s) {
    c.innerHTML = '<div>'+s+'</div>' + c.innerHTML;
  }


  function scan() {

    var tag = document.getElementById("string").value;
    var color =     stringToColor(tag);

    document.getElementById("string").style.backgroundColor = color;

    //b.style.display = 'none';
    c.innerHTML = '';
    c.style.display = 'block';


    var range = function(ip, start, end) {
      var addrs = [];
      while (start <= end) addrs.push(ip+'.'+start++);
      return addrs;
    }
    //var addrs = range('172.16.10', 1, 80).concat(range('172.16.10', 0, 50)).concat(range('10.6.0', 0, 255))

    var ip =  document.getElementById("ip").value;
    var from =  parseInt(document.getElementById("from").value);
    var to =  parseInt(document.getElementById("to").value);


    var toFingerprint = range(ip, from, to);


    lan.DeviceScan.start(toFingerprint, {
          found: function(address, fingerprint) {

            if (fingerprint == "Phrozen Shuffle XL"){
              psxl_iframe.src = "http://"+address;
              log(fingerprint+": <a class='minimallink' target='_BLANK' href='http://"+address+"'>"+address+"</a>");
            }
            else if (fingerprint == "Phrozen Sonic XL 4k"){
              psxl4k_iframe.src = "http://"+address;
              log(fingerprint+": <a class='minimallink' target='_BLANK' href='http://"+address+"'>"+address+"</a>");

            }
            else if (fingerprint == "UGS CNC Router"){
              ugscnc_iframe.src = "http://"+address+":8080";
              log(fingerprint+": <a class='minimallink' target='_BLANK' href='http://"+address+":8080'>"+address+":8080</a>");

            }
            else{
              
              log(fingerprint+": <a class='minimallink' target='_BLANK' href='http://"+address+"'>"+address+"</a>");

            }


            
          },
            complete: function(results) {

            //log("Fingerprinting Done");
          },
            hostup: function(address) {

              log("UP: <a class='minimallink' target='_BLANK' href='http://"+address+"'>"+address+"</a>");
          },
            hostdown: function(address) {

              //log("TIMEOUT: "+address);
          }

        });

    
  }
  </script>
</body>
</html>
